var Mr=Object.defineProperty;var gr=(y,p,P)=>p in y?Mr(y,p,{enumerable:!0,configurable:!0,writable:!0,value:P}):y[p]=P;var g=(y,p,P)=>(gr(y,typeof p!="symbol"?p+"":p,P),P);(function(){"use strict";function y(e){return new ReadableStream(new p(e))}class p{constructor(t){this._port=t,this._port.onmessage=s=>this._onMessage(s.data)}start(t){this._controller=t}pull(t){const s={type:"pull"};this._port.postMessage(s)}cancel(t){const s={type:"error",reason:t};this._port.postMessage(s),this._port.close()}_onMessage(t){switch(t.type){case"write":this._controller.enqueue(t.chunk);break;case"abort":this._controller.error(t.reason),this._port.close();break;case"close":this._controller.close(),this._port.close();break}}}function P(e,t){return new WritableStream(new Ke(e,t))}class Ke{constructor(t,s={}){this._port=t,this._transferChunk=s.transferChunk,this._resetReady(),this._port.onmessage=o=>this._onMessage(o.data)}start(t){return this._controller=t,this._readyPromise}write(t,s){const o={type:"write",chunk:t};let a=this._transferChunk?this._transferChunk(t):[];return a.length?this._port.postMessage(o,a):this._port.postMessage(o),this._resetReady(),this._readyPromise}close(){const t={type:"close"};this._port.postMessage(t),this._port.close()}abort(t){const s={type:"abort",reason:t};this._port.postMessage(s),this._port.close()}_onMessage(t){switch(t.type){case"pull":this._resolveReady();break;case"error":this._onError(t.reason);break}}_onError(t){this._controller.error(t),this._rejectReady(t),this._port.close()}_resetReady(){this._readyPromise=new Promise((t,s)=>{this._readyResolve=t,this._readyReject=s}),this._readyPending=!0}_resolveReady(){this._readyResolve(),this._readyPending=!1}_rejectReady(t){this._readyPending||this._resetReady(),this._readyPromise.catch(()=>{}),this._readyReject(t),this._readyPending=!1}}const T={_0_:"0".codePointAt(0),_1_:"1".codePointAt(0),_9_:"9".codePointAt(0),_a_:"a".codePointAt(0),_f_:"f".codePointAt(0),_A_:"A".codePointAt(0),_F_:"F".codePointAt(0),_openCurly_:"{".codePointAt(0),_openSquare_:"[".codePointAt(0),_closeCurly_:"}".codePointAt(0),_closeSquare_:"]".codePointAt(0),_quoteMark_:'"'.codePointAt(0),_plus_:"+".codePointAt(0),_minus_:"-".codePointAt(0),_space_:" ".codePointAt(0),_newline_:`
`.codePointAt(0),_tab_:"	".codePointAt(0),_return_:"\r".codePointAt(0),_backslash_:"\\".codePointAt(0),_slash_:"/".codePointAt(0),_comma_:",".codePointAt(0),_colon_:":".codePointAt(0),_t_:"t".codePointAt(0),_n_:"n".codePointAt(0),_b_:"b".codePointAt(0),_r_:"r".codePointAt(0),_u_:"u".codePointAt(0),_dot_:".".codePointAt(0),_e_:"e".codePointAt(0),_E_:"E".codePointAt(0),_l_:"l".codePointAt(0),_s_:"s".codePointAt(0)},{_0_:A,_1_:Fe,_9_:j,_A_:Re,_E_:qe,_F_:He,_a_:B,_b_:ze,_backslash_:K,_closeCurly_:F,_closeSquare_:Je,_colon_:Le,_comma_:Ne,_dot_:Ue,_e_:E,_f_:S,_l_:O,_minus_:R,_n_:q,_newline_:We,_openCurly_:Ve,_openSquare_:Qe,_plus_:Ze,_quoteMark_:v,_r_:H,_return_:Ge,_s_:Xe,_slash_:Ye,_space_:xe,_t_:z,_tab_:er,_u_:$}=T,C={error:"JsonFeedbackType.error"},J={unexpected:"JsonErrorType.unexpected",unexpectedEnd:"JsonErrorType.unexpectedEnd"},k=e=>({type:C.error,message:e}),_=(e,t,s)=>({type:C.error,errorType:J.unexpected,codePoint:e,context:t,expected:s}),c=(e,t)=>({type:C.error,errorType:J.unexpectedEnd,context:e,expected:t}),b=e=>e>=A&&e<=j,L=e=>e>=Fe&&e<=j,w=e=>e===xe||e===We||e===er||e===Ge,rr=(e,t={})=>{let s=t.mode??"Mode._value",o=t.parents??["Parent.top"],a=t.hexIndex??0,i=t.maxDepth??65536,u=t.isKey??!1;const f=r=>{var l;return r===Ue?(s="Mode.dot_",(l=e.codePoint)==null?void 0:l.call(e,r)):D(r)},D=r=>{var l;return r===E||r===qe?(s="Mode.exponent_",(l=e.codePoint)==null?void 0:l.call(e,r)):n(r)},n=r=>{var l;return s=o[o.length-1]==="Parent.top"?"Mode._value":"Mode.value_",(l=e.closeNumber)==null||l.call(e),W.codePoint(r)},m=()=>k(`Invalid parser state! Max depth of ${i} exceeded!`),U=r=>{var d,M;const l=o.pop();return r===F&&l==="Parent.object"?(s=o[o.length-1]==="Parent.top"?"Mode._value":"Mode.value_",(d=e.closeObject)==null?void 0:d.call(e,r)):r===Je&&l==="Parent.array"?(s=o[o.length-1]==="Parent.top"?"Mode._value":"Mode.value_",(M=e.closeArray)==null?void 0:M.call(e,r)):_(r,`in ${N(l)}`)},W={codePoint:r=>{var l,d,M,V,Q,Z,G,X,Y,x,ee,re,se,te,oe,ne,ie,ae,ue,le,_e,ce,pe,he,fe,de,Me,ge,ye,Pe,be,me,Ae,ve,Ce,ke,we,je,Ee,Se,Oe,$e,De,Ie,Te,Be;switch(s){case"Mode._value":switch(r){case Ve:return o.length>=i?m():(o.push("Parent.object"),u=!0,s="Mode._key",(l=e.openObject)==null?void 0:l.call(e,r));case Qe:return o.length>=i?m():(o.push("Parent.array"),s="Mode._value",(d=e.openArray)==null?void 0:d.call(e,r));case v:return s="Mode.string_",(M=e.openString)==null?void 0:M.call(e,r);case z:return s="Mode.t_rue",(V=e.openTrue)==null?void 0:V.call(e,r);case S:return s="Mode.f_alse",(Q=e.openFalse)==null?void 0:Q.call(e,r);case q:return s="Mode.n_ull",(Z=e.openNull)==null?void 0:Z.call(e,r);case R:return s="Mode.minus_",(G=e.openNumber)==null?void 0:G.call(e,r);case A:return s="Mode.zero_",(X=e.openNumber)==null?void 0:X.call(e,r);default:return L(r)?(s="Mode.onenine_",(Y=e.openNumber)==null?void 0:Y.call(e,r)):w(r)?(x=e.whitespace)==null?void 0:x.call(e,r):U(r)}case"Mode.value_":if(r===Ne){const I=o[o.length-1];return I==="Parent.object"?(u=!0,s="Mode._key",(ee=e.comma)==null?void 0:ee.call(e,r)):I==="Parent.array"?(s="Mode._value",(re=e.comma)==null?void 0:re.call(e,r)):k(`Invalid parser state! Unexpected parent ${I}.`)}return w(r)?(se=e.whitespace)==null?void 0:se.call(e,r):U(r);case"Mode._key":return r===v?(s="Mode.string_",(te=e.openKey)==null?void 0:te.call(e,r)):r===F?(o.pop(),u=!1,s=o[o.length-1]==="Parent.top"?"Mode._value":"Mode.value_",(oe=e.closeObject)==null?void 0:oe.call(e,r)):w(r)?(ne=e.whitespace)==null?void 0:ne.call(e,r):_(r,"in an object",['"',"}","whitespace"]);case"Mode.key_":return r===Le?(u=!1,s="Mode._value",(ie=e.colon)==null?void 0:ie.call(e,r)):w(r)?(ae=e.whitespace)==null?void 0:ae.call(e,r):_(r,"after key",[":","whitespace"]);case"Mode.string_":return r===v?u?(s="Mode.key_",(ue=e.closeKey)==null?void 0:ue.call(e,r)):(s=o[o.length-1]==="Parent.top"?"Mode._value":"Mode.value_",(le=e.closeString)==null?void 0:le.call(e,r)):r===K?(s="Mode.escape_",(_e=e.escape)==null?void 0:_e.call(e,r)):r>=32&&r<=1114111?(ce=e.codePoint)==null?void 0:ce.call(e,r):_(r,"in a string",['"',"\\","a code point 0x0020 thru 0x10ffff"]);case"Mode.escape_":return r===v||r===q||r===K||r===z||r===Ye||r===ze||r===S||r===H?(s="Mode.string_",(pe=e.codePoint)==null?void 0:pe.call(e,r)):r===$?(s="Mode.hex_",(he=e.openHex)==null?void 0:he.call(e,r)):_(r,"after escape",['"',"n","\\","t","/","b","f","r","u"]);case"Mode.hex_":return r>=A&&r<=j||r>=B&&r<=S||r>=Re&&r<=He?a<3?(a+=1,(fe=e.codePoint)==null?void 0:fe.call(e,r)):(a=0,s="Mode.string_",(de=e.closeHex)==null?void 0:de.call(e,r)):_(r,`at index ${a} of a hexadecimal escape sequence`,[["a","f"],["A","F"],["0","9"]]);case"Mode.minus_":return r===A?(s="Mode.zero_",(Me=e.codePoint)==null?void 0:Me.call(e,r)):L(r)?(s="Mode.onenine_",(ge=e.codePoint)==null?void 0:ge.call(e,r)):_(r,"after '-'",[["0","9"]]);case"Mode.zero_":return f(r);case"Mode.onenine_":return b(r)?(s="Mode.onenineDigit_",(ye=e.codePoint)==null?void 0:ye.call(e,r)):f(r);case"Mode.dot_":return b(r)?(s="Mode.digitDotDigit_",(Pe=e.codePoint)==null?void 0:Pe.call(e,r)):_(r,"after '.'",[["0","9"]]);case"Mode.exponent_":return r===Ze||r===R?(s="Mode.exponentSign_",(be=e.codePoint)==null?void 0:be.call(e,r)):b(r)?(s="Mode.exponentSignDigit_",(me=e.codePoint)==null?void 0:me.call(e,r)):_(r,"after exponent",["+","-",["0","9"]]);case"Mode.exponentSign_":return b(r)?(s="Mode.exponentSignDigit_",(Ae=e.codePoint)==null?void 0:Ae.call(e,r)):_(r,"after exponent sign",[["0","9"]]);case"Mode.onenineDigit_":return b(r)?(ve=e.codePoint)==null?void 0:ve.call(e,r):f(r);case"Mode.digitDotDigit_":return b(r)?(Ce=e.codePoint)==null?void 0:Ce.call(e,r):D(r);case"Mode.exponentSignDigit_":return b(r)?(ke=e.codePoint)==null?void 0:ke.call(e,r):n(r);case"Mode.t_rue":return r===H?(s="Mode.tr_ue",(we=e.codePoint)==null?void 0:we.call(e,r)):_(r,"at the second position in true",["r"]);case"Mode.tr_ue":return r===$?(s="Mode.tru_e",(je=e.codePoint)==null?void 0:je.call(e,r)):_(r,"at the third position in true",["u"]);case"Mode.tru_e":return r===E?(s=o[o.length-1]==="Parent.top"?"Mode._value":"Mode.value_",(Ee=e.closeTrue)==null?void 0:Ee.call(e,r)):_(r,"at the fourth position in true",["e"]);case"Mode.f_alse":return r===B?(s="Mode.fa_lse",(Se=e.codePoint)==null?void 0:Se.call(e,r)):_(r,"at the second position in false",["a"]);case"Mode.fa_lse":return r===O?(s="Mode.fal_se",(Oe=e.codePoint)==null?void 0:Oe.call(e,r)):_(r,"at the third position in false",["l"]);case"Mode.fal_se":return r===Xe?(s="Mode.fals_e",($e=e.codePoint)==null?void 0:$e.call(e,r)):_(r,"at the fourth position in false",["s"]);case"Mode.fals_e":return r===E?(s=o[o.length-1]==="Parent.top"?"Mode._value":"Mode.value_",(De=e.closeFalse)==null?void 0:De.call(e,r)):_(r,"at the fifth position in false",["e"]);case"Mode.n_ull":return r===$?(s="Mode.nu_ll",(Ie=e.codePoint)==null?void 0:Ie.call(e,r)):_(r,"at the second position in null",["u"]);case"Mode.nu_ll":return r===O?(s="Mode.nul_l",(Te=e.codePoint)==null?void 0:Te.call(e,r)):_(r,"at the third position in null",["l"]);case"Mode.nul_l":return r===O?(s=o[o.length-1]==="Parent.top"?"Mode._value":"Mode.value_",(Be=e.closeNull)==null?void 0:Be.call(e,r)):_(r,"at the fourth position in null",["l"]);default:return k(`Invalid parser mode: ${s}`)}},end:()=>{var l,d,M;if(u)return c("a key/object left unclosed!");const r=o[o.length-1];if(r!=="Parent.top")return c(`${N(r)} left unclosed!`);switch(s){case"Mode._value":return(l=e.end)==null?void 0:l.call(e);case"Mode.key_":return k("a key/object left unclosed!");case"Mode._key":return c("an object left unclosed!");case"Mode.exponentSignDigit_":case"Mode.onenine_":case"Mode.onenineDigit_":case"Mode.digitDotDigit_":case"Mode.zero_":return s=o[o.length-1]==="Parent.top"?"Mode._value":"Mode.value_",(d=e.closeNumber)==null||d.call(e),(M=e.end)==null?void 0:M.call(e);case"Mode.minus_":case"Mode.dot_":case"Mode.exponent_":case"Mode.exponentSign_":return c("incomplete number!");case"Mode.hex_":return c("after hexadecimal escape in string!");case"Mode.escape_":return c("after escape in string!");case"Mode.string_":return c("a string left unclosed!");case"Mode.t_rue":return c("before the second position in true!",["r"]);case"Mode.tr_ue":return c("before the third position in true!",["u"]);case"Mode.tru_e":return c("before the fourth position in true!",["e"]);case"Mode.f_alse":return c("before the second position in false!",["a"]);case"Mode.fa_lse":return c("before the third position in false!",["l"]);case"Mode.fal_se":return c("before the fourth position in false!",["s"]);case"Mode.fals_e":return c("before the fifth position in false!",["e"]);case"Mode.n_ull":return c("before the second position in null!",["u"]);case"Mode.nu_ll":return c("before the third position in null!",["l"]);case"Mode.nul_l":return c("before the fourth position in null!",["l"]);default:return c()}},state:()=>{var l;const r=(l=e.state)==null?void 0:l.call(e);return{mode:s,parents:[...o],isKey:u,hexIndex:a,downstream:r}},config:()=>{var l;const r=(l=e.config)==null?void 0:l.call(e);return{maxDepth:i,downstream:r}}};return W},N=e=>{switch(e){case"Parent.array":return"an array";case"Parent.object":return"an object";case"Parent.top":return"the top-level value"}},{_t_:sr,_n_:tr,_b_:or,_r_:nr,_f_:ir}=T,ar=e=>{let t="top",s="",o="",a=[];const i=[],u=n=>i.length>0?[i.pop(),n]:[n],f=()=>(s="",t="string",i.length>0?[i.pop()]:[]);return{openString:f,openKey:f,openNumber:n=>(o=String.fromCharCode(n),t="number",i.length>0?[i.pop()]:[]),openObject:()=>{var n;return u((n=e.openObject)==null?void 0:n.call(e))},openArray:()=>{var n;return u((n=e.openArray)==null?void 0:n.call(e))},closeObject:()=>{var n;return u((n=e.closeObject)==null?void 0:n.call(e))},closeArray:()=>{var n;return u((n=e.closeArray)==null?void 0:n.call(e))},closeTrue:()=>{var n;return u((n=e.value)==null?void 0:n.call(e,!0))},closeFalse:()=>{var n;return u((n=e.value)==null?void 0:n.call(e,!1))},closeNull:()=>{var n;return u((n=e.value)==null?void 0:n.call(e,null))},codePoint:n=>(t==="string"?s+=String.fromCodePoint(n):t==="escape"?(n===tr?s+=`
`:n===sr?s+="	":n===nr?s+="\r":n===or?s+="\b":n===ir?s+="\f":s+=String.fromCharCode(n),t="string"):t==="hex"?a.push(n):t==="number"&&(o+=String.fromCharCode(n)),i.length>0?[i.pop()]:[]),escape:()=>(t="escape",i.length>0?[i.pop()]:[]),openHex:()=>(a=[],t="hex",i.length>0?[i.pop()]:[]),closeString:()=>{var n;return t="top",u((n=e.value)==null?void 0:n.call(e,s))},closeKey:()=>{var n;return t="top",u((n=e.key)==null?void 0:n.call(e,s))},closeHex:n=>(a.push(n),s+=String.fromCharCode(Number.parseInt(String.fromCharCode(...a),16)),t="string",i.length>0?[i.pop()]:[]),closeNumber:()=>{var n;return t="top",i.push((n=e.value)==null?void 0:n.call(e,Number.parseFloat(o))),[]},end:()=>{var m;const n=[];return i.length>0&&n.push(i.pop()),n.push((m=e.end)==null?void 0:m.call(e)),n}}},ur=`
`.charCodeAt(0),lr=e=>{let t=0,s=0,o=0;const a={codePoint:i=>{const u=e.codePoint(i),f={pos:t,line:s,col:o,...u};return t+=1,i===ur?(s+=1,o=0):o+=1,f},end:()=>{const i=e.end();return t+=1,o+=1,{pos:t,line:s,col:o,...i}}};return new Proxy(e,{get:(i,u,f)=>a[u]||i[u]})},_r=e=>{const t=lr(rr(ar(e))),s={chunk(o){for(const a of o){const i=[t.codePoint(a.codePointAt(0))].flat();for(const u of i)if(u.type===C.error)throw Error(JSON.stringify(u))}return s},end(){return t.end()},state(){return t.state()}};return s};var h=(e=>(e[e.OpenArray=0]="OpenArray",e[e.OpenObject=1]="OpenObject",e[e.CloseArray=2]="CloseArray",e[e.CloseObject=3]="CloseObject",e[e.Property=4]="Property",e[e.Error=5]="Error",e[e.Loading=6]="Loading",e))(h||{});class cr{constructor(){g(this,"reader");g(this,"currentLevel",-1);g(this,"path",[]);g(this,"arraysIndexes",[]);g(this,"currentKey",null);g(this,"linesBuffer",null);g(this,"currentContainer",null);this.reader=_r({openArray:this.handleOpenArray.bind(this),openObject:this.handleOpenObject.bind(this),closeArray:this.handleClose.bind(this),closeObject:this.handleClose.bind(this),key:this.handleKey.bind(this),value:this.handleValue.bind(this)})}convertChunk(t){let s=null;return{lines:this.withCleanBuffer(()=>{try{this.reader.chunk(t)}catch(a){s=this.captureErrorAsLine(JSON.parse(a.message))}}),error:s}}end(){let t=null;return{lines:this.withCleanBuffer(()=>{const o=this.reader.end();"errorType"in o&&(t=this.captureErrorAsLine(o))}),error:t}}withCleanBuffer(t){this.linesBuffer=[],t();const s=this.linesBuffer;return this.linesBuffer=[],s}_handleOpen(t){const s=this.calculateCurrentKey();(s||this.currentContainer===h.OpenArray)&&this.linesBuffer.push({type:t,level:this.currentLevel,key:s,container:this.currentContainer}),this.currentLevel++,this.path.push(t),this.currentContainer=t}handleOpenArray(){this._handleOpen(h.OpenArray),this.arraysIndexes.push(0)}handleOpenObject(){this._handleOpen(h.OpenObject)}handleClose(){this.currentLevel--,this.currentContainer=this.path.pop(),this.currentContainer===h.OpenArray&&this.arraysIndexes.pop(),this.currentContainer===h.OpenArray&&this.linesBuffer.push({type:h.CloseArray,level:this.currentLevel})}handleKey(t){this.currentKey=t}handleValue(t){const s=this.calculateCurrentKey();typeof t=="string"&&(t=`"${t}"`),this.linesBuffer.push({type:h.Property,level:this.currentLevel,key:s,value:t})}calculateCurrentKey(){let t=this.currentKey;return this.currentKey=null,t||(t=this.arraysIndexes[this.arraysIndexes.length-1],this.arraysIndexes[this.arraysIndexes.length-1]++),t??""}captureErrorAsLine(t){const s=pr(t);return this.linesBuffer.push({type:h.Error,level:this.currentLevel,message:s.message}),s}}function pr(e){return e.type==="JsonFeedbackType.error"&&e.pos===0?{type:"invalid-file",message:"Invalid file. Please load a valid JSON file"}:e.errorType==="JsonErrorType.unexpected"?{type:"unexpected",message:`Unexpected token "${String.fromCodePoint(e.codePoint).replace(`
`,"\\n")}" ${e.context} at line ${e.line}, column ${e.col}. Expected: ${e.expected.join(", ")}`}:e.errorType==="JsonErrorType.unexpectedEnd"?{type:"unexpected",message:`Unexpected end of input at line ${e.line}, column ${e.col}. ${e.context}`}:{type:"unexpected",message:`Unexpected error: ${e}`}}self.onmessage=async e=>{const{readablePort:t,writablePort:s}=e.data,o=y(t),a=P(s),i={processedBytes:0,chunkIndex:-1};await o.pipeThrough(dr(1e4)).pipeThrough(fr(i)).pipeThrough(new TextDecoderStream).pipeThrough(hr(i)).pipeTo(a)};function hr(e){const t=new cr;return new TransformStream({transform(s,o){const{lines:a,error:i}=t.convertChunk(s);o.enqueue({lines:a,error:i,stats:e}),i&&o.terminate()},flush(s){const{lines:o,error:a}=t.end();o.length&&s.enqueue({lines:o,error:a,stats:e}),a&&s.terminate()}})}function fr(e){return new TransformStream({transform(t,s){e.processedBytes+=t.length,e.chunkIndex++,s.enqueue(t)}})}function dr(e){return new TransformStream({transform(t,s){for(let o=0;o<t.length;o+=e)s.enqueue(t.slice(o,o+e))}})}})();
